# Frontend Dashboard

React + Vite dashboard for displaying portfolio performance and market analysis.

## Quick Start

```bash
cd frontend

# Install dependencies
npm install

# Development server (http://localhost:5173)
npm run dev

# Production build
npm run build
```

## Project Structure

```
frontend/
├── src/
│   ├── components/       # React components
│   │   ├── HeroMetrics.tsx        # Key portfolio metrics
│   │   ├── EquityCurve.tsx        # Portfolio value chart
│   │   ├── DrawdownChart.tsx      # Drawdown visualization
│   │   ├── MonthlyReturnsHeatmap.tsx  # Calendar heatmap
│   │   ├── WeatherReport.tsx      # Market weather + regime
│   │   ├── PortfolioTable.tsx     # Current holdings
│   │   ├── CandidatesTable.tsx    # Buy candidates
│   │   ├── EnsembleStatus.tsx     # Regime Decision panel (fusion trail)
│   │   ├── RegimeStrip.tsx        # Market intelligence strip + regime history
│   │   ├── MacroCreditPanel.tsx   # Macro/credit expert chart
│   │   ├── VolComplexPanel.tsx    # Volatility complex expert chart
│   │   ├── FragilityPanel.tsx     # Cross-asset fragility expert chart
│   │   └── EntropyPanel.tsx       # Entropy/distribution shift expert chart
│   ├── hooks/
│   │   ├── useDashboardData.ts    # Dashboard data fetching hook
│   │   └── useTimeseriesData.ts   # Timeseries data fetching hook
│   ├── types/
│   │   └── index.ts               # TypeScript interfaces
│   ├── App.tsx                    # Main app component
│   └── index.css                  # Global styles
├── public/
│   ├── data/
│   │   └── dashboard.json         # Sample data
│   └── chart.svg                  # Favicon
└── dist/                          # Build output
```

## Data Source

The dashboard fetches data from `./data/dashboard.json` by default. In production, this file is generated by the Lambda pipeline and uploaded to S3.

### Environment Variable

Set `VITE_DATA_URL` at build time. For production (S3 static hosting), use:

```bash
VITE_DATA_URL=dashboard.json npm run build
```

This makes the app fetch `dashboard.json` and `timeseries.json` from the same S3 prefix. Without this variable, it defaults to `./data/dashboard.json` (local dev).

## Dashboard Components

### Hero Metrics
- Total portfolio value
- YTD and MTD returns
- Sharpe ratio
- Max drawdown
- Win rate

### Equity Curve
- Portfolio value over time
- SPY benchmark comparison
- Interactive tooltip

### Drawdown Chart
- Drawdown percentage over time
- Red fill visualization

### Monthly Returns Heatmap
- Color-coded returns by month/year
- Green (positive) to red (negative)
- YTD totals

### Weather Report
- LLM-generated market summary
- Current regime indicator
- Key risks

### Portfolio Tables
- Current holdings with P&L, health scores, vol bucket, days held
- Top buy candidates ranked by score with 21d returns, behavior type, suggested size

### Market Intelligence (Phase 6)

#### Regime Strip
- Current regime label with confidence
- Risk throttle indicator
- Expert signal summary bars (macro, vol, fragility, entropy, position size)
- 60-day regime history color strip

#### Regime Decision Panel
- Final fused regime with position size and throttle
- Override reason badge when active
- Two-column inputs: ensemble models (GRU/Transformer predictions + agreement) and expert signals (4 scores with threshold bars)
- Fusion logic trail: 6 priority-ordered rules showing active/inactive state

#### Expert Signal Charts (4 panels, driven by timeseries.json)
- **Macro/Credit**: Score line + yield slope overlay
- **Volatility Complex**: Vol score + VIX/VVIX percentiles with regime shading
- **Cross-Asset Fragility**: Fragility score + avg correlation with 0.75 threshold line
- **Entropy/Distribution Shift**: Entropy score + z-score + shift event markers

## Deployment to S3

The frontend is designed for S3 static website hosting.

```bash
# Build
cd frontend
npm run build

# Upload to S3 (see docs/DEPLOY.md for full command with --exclude flags)
aws s3 sync dist/ s3://investment-system-data/dashboard/ \
  --exclude "dashboard.json" --exclude "timeseries.json" \
  --exclude "timeseries.parquet" --exclude "data/*" \
  --delete --region us-east-1
```

### S3 Static Website Configuration

1. Enable static website hosting on bucket
2. Set index document to `index.html`
3. Ensure public read access for dashboard/* prefix (see DEPLOY.md)

## Data Schema

See `src/types/index.ts` for the complete TypeScript interfaces. Key types:

```typescript
interface DashboardData {
  metrics: PortfolioMetrics;
  holdings: Holding[];
  candidates: BuyCandidate[];
  equity_curve: EquityCurvePoint[];
  drawdowns: DrawdownPoint[];
  monthly_returns: MonthlyReturn[];
  weather: WeatherReport;
  expert_signals?: ExpertSignals;   // Phase 6: expert signal scores + fusion outputs
  timeseries_url?: string;          // Phase 6: URL to timeseries.json for charts
}
```

## Dependencies

- React 18
- Recharts (charting)
- date-fns (date formatting)
- TypeScript
- Vite

## Styling

Uses CSS custom properties for theming. Dark theme by default.

Key colors:
- `--bg-primary`: #0f172a (background)
- `--accent-green`: #22c55e (positive)
- `--accent-red`: #ef4444 (negative)
- `--accent-blue`: #3b82f6 (primary accent)
